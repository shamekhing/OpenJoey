void CALLBACK CMIDIInput::MidiInProc(HMIDIIN hMidiIn, WORD wMsg, DWORD dwInstance,
						   DWORD dwParam1, DWORD dwParam2)
{
// Note OnとOffでm_byKeyBuffer2を変更
	CMIDIInput* myclass = (CMIDIInput*) dwInstance;

	int Status = dwParam1 & 0xf0;			// Status
	int Key = (dwParam1 >> 8) & 0xff;		// data1
	int Velocity = (dwParam1 >> 16) & 0xff; // data2

	switch (wMsg){
	case MIM_DATA:
		switch (Status) {
		case 0x90:
			// Note On or Off
			myclass->m_byKeyBuffer2[Key] = Velocity;
			break;
		case 0x80:
			// これがNote Offで有り得る
			myclass->m_byKeyBuffer2[Key] = 0;
			break;
		case 0xb0:
			if (Key == 0x43)	  myclass->m_byKeyBuffer2[253] = Velocity; // left pedal
			else if (Key == 0x42) myclass->m_byKeyBuffer2[254] = Velocity; // middle pedal
			else if (Key == 0x40) myclass->m_byKeyBuffer2[255] = Velocity; // right pedal
			break;
		}

	// 他のメッセージは無視しちゃる！
	}
}
