class function_callback {
public:
	virtual LRESULT Call(DWORD dwParam)=0;
	virtual ~function_callback(){}
};

//	メンバ関数ポインタのサイズはクラス依存なので、汎用型のようなものは
//	存在しない。そこで、このようなことをしなくてはならなくなる。
template <class T>
class t_function_callback : public function_callback {
public:
	t_function_callback(){
		m_pThis = NULL;
		m_pFunc = NULL;
	}

	virtual LRESULT Call(DWORD dwParam) {
		if (m_pThis) return (m_pThis->*m_pFunc)(dwParam);
		return 0;
	}
	virtual void SetFunction(T* pThis,LRESULT (T::*pFunc)(DWORD)){
		m_pThis = pThis;
		m_pFunc = pFunc;
	}
	//	↑の逆変換
	virtual void GetFunction(T*&pThis,LRESULT (T::*&pFunc)(DWORD)){
		pThis = m_pThis;
		pFunc = m_pFunc;
	}
private:
	T* m_pThis;
	LRESULT (T::*m_pFunc)(DWORD);
};
